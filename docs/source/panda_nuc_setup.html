

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Set up NUC (Control PC) for the Franka Panda &mdash; perls2 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Set up workstation for Franka Panda" href="panda_ws_setup.html" />
    <link rel="prev" title="Camera Interface" href="../camera_interface.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> perls2
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="panda_setup.html">Franka Panda Setup</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="worlds.html">World</a></li>
<li class="toctree-l1"><a class="reference internal" href="robot_interfaces.html">RobotInterfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller_eqns.html">Controllers</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../simple_reach.html">Simple Reach Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_objects.html">Examples: Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch_sim_real.html">Switching between Real and Sim Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_template.html">Project Template</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../env.html">Environment (Env)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../world.html">World</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot_interface.html">Robot Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller.html">Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../object_interface.html">Object Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../camera_interface.html">Camera Interface</a></li>
</ul>
<p class="caption"><span class="caption-text">Real Robot Control</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="panda_setup.html">Franka Panda Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Set up NUC (Control PC) for the Franka Panda</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#important-notes">Important notes:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-nuc">Setting up the NUC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#secure-your-redis-server">Secure your redis server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verify-perls2-setup-by-running-pandactrlinterface">Verify perls2 setup by running PandaCtrlInterface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="panda_ws_setup.html">Set up workstation for Franka Panda</a></li>
<li class="toctree-l1"><a class="reference internal" href="panda_instructions.html">Using the Franka Panda</a></li>
<li class="toctree-l1"><a class="reference internal" href="redis.html">Redis Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="sawyer_instructions.html">Using the Rethink Sawyer Arm</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Controller Demos</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">perls2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Set up NUC (Control PC) for the Franka Panda</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/source/panda_nuc_setup.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="set-up-nuc-control-pc-for-the-franka-panda">
<h1>Set up NUC (Control PC) for the Franka Panda<a class="headerlink" href="#set-up-nuc-control-pc-for-the-franka-panda" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The NUC or Control PC runs three processes to control the Franka Panda arm.</p>
<ol class="simple">
<li><p>franka-panda-iprl driver : A wrapper for libfranka that gets torque commands from redis and updates the redis-server with robot states.</p></li>
<li><p>perls2.PandaCtrlInterface: A process that grabs robot commands from the perls2 environment hosted on the workstation, and robot states from the franka-panda-iprl driver. This process implements the controller and calculates the torques necessary to acheive the desired robot states, setting the torque command to redis.</p></li>
<li><p>redis-server : A redis server is used to communicate between the franka-panda-iprl redis driver (a wrapper for libfranka) and the perls2.PandaCtrlInterface</p></li>
</ol>
</div>
<div class="section" id="important-notes">
<h2>Important notes:<a class="headerlink" href="#important-notes" title="Permalink to this headline">¶</a></h2>
<p>To ensure consistent control loop timing, it is important that no other processes be running on the NUC. This includes internet browsers or text editors. After initial set up, the NUC should be accessed only by ssh from the workstation.</p>
</div>
<div class="section" id="setting-up-the-nuc">
<h2>Setting up the NUC<a class="headerlink" href="#setting-up-the-nuc" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Set up the Ubuntu 16.04 with RT-PREEMPT Kernel by following the <a class="reference external" href="https://frankaemika.github.io/docs/installation_linux.html#setting-up-the-real-time-kernel">instructions here</a> on frankaemika.</p></li>
<li><p>Follow the <a class="reference external" href="https://frankaemika.github.io/docs/getting_started.html#control-network-configuration">instructions here</a> to set up the Franka Panda Arm and Network. There is no need to install libfranka just yet, the driver will do this later. It’s best to use a high bandwith network switch to connect the workstation, the FCI and the NUC to a local network.</p></li>
<li><p>Disable cpu power scaling using cpufrequtils by following the <a class="reference external" href="https://frankaemika.github.io/docs/troubleshooting.html#disabling-cpu-frequency-scaling">instructions here</a></p></li>
</ol>
<p>The default setting slow down the CPU frequency for power conservation. We want our control loop to run as fast as possible to maintain a high frequency for torque control.</p>
<ol class="simple">
<li><p><a class="reference internal" href="introduction.html#installing"><span class="std std-ref">Clone and install perls2</span></a></p></li>
<li><p>Install redis.
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">redis-server</span></code></p></li>
<li><p>Install the <a class="reference external" href="https://github.com/StanfordVL/franka-panda-iprl/">franka-panda-iprl driver.</a> This is used by perls2 as a redis-wrapper for libfranka. Please note that this version of the driver has been modified specifically to work with perls2.</p></li>
</ol>
<div class="section" id="secure-your-redis-server">
<h3>Secure your redis server<a class="headerlink" href="#secure-your-redis-server" title="Permalink to this headline">¶</a></h3>
<p>Because redis-server process requests very quickly, it is critical to secure your redis-server by setting a password. It’s best to set a very long, randomly generated password.</p>
<ol>
<li><p>Copy the redis.conf file found in perls2/redis_interfaces/redis.conf to the NUC’s home directory. This conf file contains the redis-server password, so we don’t want it online.</p></li>
<li><p>Edit the line “requirepass foobared” to “requirepass &lt; your_password_here &gt; “.</p></li>
<li><p>Copy the redis_passfile.txt from perls2 to a hidden folder in your home directory. Change the text to the password you entered in the redis.conf</p></li>
<li><p>Modify the perls2/cfg/redis_nuc.yaml file by changing the value of the <code class="docutils literal notranslate"><span class="pre">password</span></code> key to the filepath of your redis_passfile.txt. E.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redis</span><span class="p">:</span>
    <span class="n">host</span><span class="p">:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
    <span class="n">port</span><span class="p">:</span> <span class="mi">6379</span>
    <span class="n">password</span><span class="p">:</span> <span class="s1">&#39;/home/user/.hidden_redis/redis_passfile.txt&#39;</span>
</pre></div>
</div>
</li>
<li><p>Modify the perls2/cfg/franka-panda.yaml by changing the value of the <code class="docutils literal notranslate"><span class="pre">password</span></code> key just as you did for perls2.</p></li>
<li><p>Run your redis-server with the conf file you’ve copied from perls2. If you don’t use the conf file, your redis-server will not be secured.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">redis</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
<li><p>Verify that your redis-server is secured by opening <a class="reference internal" href="redis.html"><span class="doc">redis-cli</span></a> in another terminal</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">h</span> <span class="o">&lt;</span><span class="n">host_ip</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">h</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">6379</span>
</pre></div>
</div>
</li>
<li><p>Running any command in redis-cli should respond with a message ‘AUTH Required’:
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">keys</span> <span class="o">*</span>
<span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="n">AUTH</span> <span class="n">Required</span>
</pre></div>
</div>
</li>
<li><p>You can enter a password for redis-cli by using AUTH followed by the password you set in the conf file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">AUTH</span> <span class="n">your</span><span class="o">-</span><span class="n">password</span>
<span class="n">OK</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="verify-perls2-setup-by-running-pandactrlinterface">
<h3>Verify perls2 setup by running PandaCtrlInterface<a class="headerlink" href="#verify-perls2-setup-by-running-pandactrlinterface" title="Permalink to this headline">¶</a></h3>
<ol>
<li><p>Start the redis-server</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="n">redis</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
<li><p>In the Desk app, unlock the robot. The lights at the base of the robot should be white.</p></li>
<li><p>Pull the E-Stop so the lights are blue.</p></li>
<li><p>Start the franka-panda driver using the perl2 config.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">franka</span><span class="o">-</span><span class="n">panda</span><span class="o">-</span><span class="n">iprl</span><span class="o">/</span><span class="nb">bin</span>
<span class="o">./</span><span class="n">franka</span><span class="o">-</span><span class="n">panda</span><span class="o">-</span><span class="n">iprl</span> <span class="o">~/</span><span class="n">perls2</span><span class="o">/</span><span class="n">cfg</span><span class="o">/</span><span class="n">franka</span><span class="o">-</span><span class="n">panda</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Open another terminal and source the perls2 environment.</p></li>
<li><p>Run the Panda Control Interface</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">perls2</span>
<span class="n">python</span> <span class="n">perls2</span><span class="o">/</span><span class="n">ctrl_interfaces</span><span class="o">/</span><span class="n">panda_ctrl_interface</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p>You should see the message:
<code class="docutils literal notranslate"><span class="pre">Waiting</span> <span class="pre">for</span> <span class="pre">perls2.RobotInterface</span> <span class="pre">to</span> <span class="pre">connect</span></code></p></li>
<li><p>Exit the Ctrl Interface with <code class="docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">C</span></code></p></li>
<li><p>Exit the Driver with <code class="docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">+</span> <span class="pre">C</span></code></p></li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="panda_ws_setup.html" class="btn btn-neutral float-right" title="Set up workstation for Franka Panda" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../camera_interface.html" class="btn btn-neutral float-left" title="Camera Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, StanfordVL

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>